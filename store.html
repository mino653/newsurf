<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SurfNetwork Store</title>
    <meta name="description" content="Join SurfNetwork - The ultimate Minecraft server experience with custom maps, ranks, and amazing community!">
    <link rel="icon" type="image/x-icon" href="./assets/icon32x32.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@flaticon/flaticon-uicons@3.3.1/css/all/all.min.css">
    <link rel="stylesheet" href="./css/styles.css">
    <style>
        /* Animations and layout improvements only inside this file (no external CSS changed) */
        :root {
            --card-bg: #071025;
            --card-radius: 12px;
            --card-ease: cubic-bezier(.2,.9,.25,1);
        }

        /* Categories */
        .store-categories { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:18px; align-items:center; }
        .category-btn { display:flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; background:transparent; border:1px solid rgba(255,255,255,0.06); color:inherit; transition:transform .18s var(--card-ease), box-shadow .18s var(--card-ease), background .18s var(--card-ease); cursor:pointer; }
        .category-btn:hover { transform:translateY(-3px) scale(1.01); box-shadow:0 8px 20px rgba(2,6,23,.45); }
        .category-btn.active { background:linear-gradient(90deg,#6dd3ff33,#9b7bff33); box-shadow: 0 10px 30px rgba(124,58,237,0.12); }
        .category-btn .btn-icon { display:inline-flex; width:20px; height:20px; align-items:center; justify-content:center; }

        /* Grid and cards */
        .store-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:16px; align-items:stretch; }
        .store-card { background:var(--card-bg); border-radius:var(--card-radius); overflow:hidden; color:#e6eef8; display:flex; flex-direction:column; min-height:320px; box-shadow: 0 6px 18px rgba(2,6,23,.6); transform-origin:center; transition: transform .25s var(--card-ease), box-shadow .25s var(--card-ease); will-change:transform; opacity:0; animation:cardIn .46s var(--card-ease) both; animation-delay: calc(var(--i) * 80ms); }
        .store-card:hover { transform:translateY(-8px) scale(1.02); box-shadow: 0 18px 42px rgba(2,6,23,.7); }

        .store-card img { width:100%; height:140px; object-fit:cover; display:block; transition:transform .45s var(--card-ease); }
        .store-card:hover img { transform: scale(1.06); }

        .card-body { padding:12px 14px; display:flex; flex-direction:column; gap:8px; flex:1 1 auto; }
        .card-body h3 { margin:0; font-size:1.05rem; display:flex; justify-content:space-between; align-items:center; gap:12px; }
        .price-badge { background:rgba(255,255,255,0.06); padding:6px 8px; border-radius:8px; font-weight:700; font-size:.95rem; color:#fff; }
        .card-desc { margin:0; color:#b8c6d8; font-size:.92rem; line-height:1.25; min-height:2.6em; }
        .card-actions { display:flex; gap:8px; margin-top:auto; align-items:center; }
        .buy-btn { margin-left:auto; background:linear-gradient(90deg,#10b981,#06b6d4); color:#fff; padding:8px 12px; border-radius:10px; text-decoration:none; font-weight:700; transition:transform .15s var(--card-ease); }
        .buy-btn:hover { transform:translateY(-3px) scale(1.02); }
        .fav-btn { background:transparent; border:0; color:#ff7aa2; cursor:pointer; font-size:18px; transition:transform .12s var(--card-ease); }
        .fav-btn:active { transform:scale(.9); }
        .small-meta { font-size:.85rem; color:#9fb0c8; }

        /* Modal animations & layout */
        #checkout-modal { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:1200; pointer-events:none; }
        #checkout-modal .modal-backdrop { position:absolute; inset:0; background:rgba(2,6,23,.6); opacity:0; transition:opacity .28s var(--card-ease); pointer-events:none; }
        #checkout-modal .modal-dialog { width:100%; max-width:720px; margin:20px; background:linear-gradient(180deg,#071225,#0b1b2b); border-radius:12px; transform:translateY(8px) scale(.98); opacity:0; transition:transform .28s var(--card-ease), opacity .28s var(--card-ease); box-shadow:0 18px 60px rgba(2,6,23,.7); position:relative; pointer-events:auto; overflow:hidden; }
        #checkout-modal.open .modal-backdrop { opacity:1; pointer-events:auto; }
        #checkout-modal.open .modal-dialog { transform:translateY(0) scale(1); opacity:1; }
        .modal-header { display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid rgba(255,255,255,0.03); }
        .modal-body { padding:14px 16px; display:flex; gap:12px; align-items:flex-start; flex-wrap:wrap; }
        .checkout-item img { border-radius:8px; width:120px; height:80px; object-fit:cover; flex-shrink:0; }
        .modal-footer { display:flex; gap:10px; padding:12px 16px; border-top:1px solid rgba(255,255,255,0.03); justify-content:flex-end; }

        /* small screens tweak */
        @media (max-width:520px) {
            .store-card { min-height:300px; }
            .card-body h3 { font-size:1rem; }
            .checkout-item img { width:110px; height:70px; }
            .modal-dialog { margin:12px; }
        }

        @keyframes cardIn {
            from { transform:translateY(10px) scale(.995); opacity:0; }
            to   { transform:translateY(0) scale(1); opacity:1; }
        }
    </style>
</head>

<body>
    <div class="preloader">
        <figure> <img src="./assets/icon128x128.png" alt="Icon"> </figure>
    </div>
    <script src='https://www.noupe.com/embed/019a110c65f87ab89c4a3on17a0f495e780add.js'></script>
    <nav class="navbar" include-html="./nav.html"></nav>

    <!-- Store Section -->
    <section id="store" class="store">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Server Store</h2>
                <div class="section-subtitle">Support the server and unlock exclusive perks!</div>
            </div>

            <div class="store-categories" role="tablist" aria-label="Store categories">
                <button class="category-btn active" data-category="ranks" role="tab" aria-selected="true" aria-controls="store-grid">
                    <span class="btn-icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M5 11l2.5-5L12 10l4.5-4L19 11l-7 9-7-9z"/></svg>
                    </span>
                    <span class="btn-text">Ranks</span>
                </button>
                <button class="category-btn" data-category="coins" role="tab" aria-selected="false" aria-controls="store-grid">
                    <span class="btn-icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><circle cx="12" cy="12" r="8"></circle><path d="M9 9h6v6H9z" fill="#fff"></path></svg>
                    </span>
                    <span class="btn-text">Coins</span>
                </button>
                <button class="category-btn" data-category="cosmetics" role="tab" aria-selected="false" aria-controls="store-grid">
                    <span class="btn-icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 2a10 10 0 1 0 10 10c0-5.523-4.477-10-10-10zm-1 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm4 4a1 1 0 1 1 .001 1.999A1 1 0 0 1 15 12zM8 11a1 1 0 1 1 .001 1.999A1 1 0 0 1 8 11z"/></svg>
                    </span>
                    <span class="btn-text">Cosmetics</span>
                </button>
                <button class="category-btn" data-category="boosters" role="tab" aria-selected="false" aria-controls="store-grid">
                    <span class="btn-icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M13 2L3 14h7l-1 8L21 10h-7l-1-8z"/></svg>
                    </span>
                    <span class="btn-text">Boosters</span>
                </button>
            </div>

            <div class="store-grid" id="store-grid" data-item-count="0" role="region" aria-live="polite">
                <!-- Items will be injected here -->
            </div>
        </div>
    </section>
    
    <!-- Checkout Modal (hidden by default; uses your site's CSS if available) -->
    <div id="checkout-modal" class="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="checkout-title">
        <div class="modal-backdrop" data-modal-backdrop></div>
        <div class="modal-dialog" role="document">
            <header class="modal-header">
                <h3 id="checkout-title">Checkout</h3>
                <button class="modal-close" data-modal-close aria-label="Close">×</button>
            </header>
            <div class="modal-body" id="checkout-body">
                <div class="checkout-item" style="display:flex;gap:12px;align-items:flex-start;">
                    <img id="checkout-image" src="" alt="" style="max-width:120px;border-radius:8px;">
                    <div style="min-width:0;">
                        <h4 id="checkout-name" style="margin:0 0 6px 0;"></h4>
                        <p id="checkout-desc" class="small-meta" style="margin:0 0 6px 0;"></p>
                        <p id="checkout-duration" class="small-meta" style="margin:0;"></p>
                    </div>
                </div>

                <!-- Payment provider selection (Tebex enabled by default) -->
                <div style="margin-top:12px;">
                    <label style="display:block;margin-bottom:6px;">Payment provider</label>
                    <select id="payment-provider" style="padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;">
                        <option value="tebex" selected>Tebex (recommended)</option>
                        <option value="stripe" disabled>Stripe (disabled in this build)</option>
                    </select>
                    <small class="small-meta" style="display:block;margin-top:8px;">You will be redirected to the Tebex checkout to complete payment.</small>
                </div>

                <div class="checkout-summary" style="margin-top:12px;">
                    <p>Total: <strong id="checkout-price"></strong></p>
                </div>
                <div class="checkout-steps" style="margin-top:12px;">
                    <label for="checkout-ign">Minecraft IGN:</label>
                    <input id="checkout-ign" name="ign" type="text" placeholder="Your in-game name" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;margin-top:6px;" />
                </div>
            </div>
            <footer class="modal-footer">
                <button class="btn btn-secondary" data-modal-cancel>Cancel</button>
                <button class="btn btn-primary" id="checkout-confirm">Confirm Purchase</button>
            </footer>
        </div>
    </div>

    <!-- Contact Section -->
    <section id="contact" class="contact" include-html="./contact.html"></section>

    <footer class="footer" include-html="./footer.html"></footer>

    <script type="module" src="./js/script.js"></script>

    <script>
    // Tebex configuration
    // TODO: Replace with your actual Tebex store domain (the domain of your Tebex store)
    // Example: const TEBEX_STORE_URL = 'https://yourstore.tebex.io';
    const TEBEX_STORE_URL = 'https://yourstore.tebex.io';

    // Map itemId (as used in the frontend items list) to Tebex package identifier (slug or numeric ID).
    // Replace the right-hand values with the package IDs or slugs from your Tebex store.
    const ITEM_TO_TEBEX = {
        'rank-vip': '12345',        // replace with your Tebex package id or slug
        'rank-pro': '12346',
        'rank-legend': '12347',
        'coins-500': 'coins-500',
        'coins-2500': 'coins-2500',
        'cosmetic-trail': 'sparkle-trail',
        'cosmetic-hat': 'dragon-hat',
        'booster-xp-2h': 'xp-2h',
        'booster-coin-24h': 'coin-24h'
    };
    </script>

    <script>
    // Client-side store renderer, category filtering and Tebex checkout redirect
    (function () {
        const storeGrid = document.getElementById('store-grid');
        const categoryButtons = Array.from(document.querySelectorAll('.category-btn'));
        const paymentProviderSelect = document.getElementById('payment-provider');
        const checkoutConfirm = document.getElementById('checkout-confirm');
        const checkoutIGN = document.getElementById('checkout-ign');

        // Example items - replace/add your real store items here or fetch from an API
        const items = [
            // Ranks
            { id: 'rank-vip', category: 'ranks', title: 'VIP', price: '5.00', currency: 'USD', duration: 'Permanent', description: 'VIP rank with access to exclusive servers and commands.', image: 'https://via.placeholder.com/640x360.png?text=VIP+Rank' },
            { id: 'rank-pro', category: 'ranks', title: 'Pro', price: '12.00', currency: 'USD', duration: 'Permanent', description: 'Pro rank - all VIP perks + special prefix.', image: 'https://via.placeholder.com/640x360.png?text=Pro+Rank' },
            { id: 'rank-legend', category: 'ranks', title: 'Legend', price: '25.00', currency: 'USD', duration: 'Permanent', description: 'Legend rank with custom titles, particles and more.', image: 'https://via.placeholder.com/640x360.png?text=Legend+Rank' },

            // Coins
            { id: 'coins-500', category: 'coins', title: '500 Coins', price: '1.99', currency: 'USD', description: 'In-game currency pack.', image: 'https://via.placeholder.com/640x360.png?text=500+Coins' },
            { id: 'coins-2500', category: 'coins', title: '2,500 Coins', price: '7.49', currency: 'USD', description: 'Best value coin pack.', image: 'https://via.placeholder.com/640x360.png?text=2500+Coins' },

            // Cosmetics
            { id: 'cosmetic-trail', category: 'cosmetics', title: 'Sparkle Trail', price: '2.99', currency: 'USD', description: 'A sparkling trail behind your player.', image: 'https://via.placeholder.com/640x360.png?text=Sparkle+Trail' },
            { id: 'cosmetic-hat', category: 'cosmetics', title: 'Dragon Hat', price: '3.99', currency: 'USD', description: 'A fierce dragon-styled hat for your avatar.', image: 'https://via.placeholder.com/640x360.png?text=Dragon+Hat' },

            // Boosters
            { id: 'booster-xp-2h', category: 'boosters', title: 'XP Booster (2h)', price: '1.49', currency: 'USD', description: 'Double XP for 2 hours.', image: 'https://via.placeholder.com/640x360.png?text=XP+Booster' },
            { id: 'booster-coin-24h', category: 'boosters', title: 'Coin Booster (24h)', price: '4.99', currency: 'USD', description: 'Double coins for 24 hours.', image: 'https://via.placeholder.com/640x360.png?text=Coin+Booster' }
        ];

        // Favorites persisted in localStorage
        const favKey = 'surf_store_favs_v1';
        const favorites = new Set(JSON.parse(localStorage.getItem(favKey) || '[]'));

        function saveFavs() {
            localStorage.setItem(favKey, JSON.stringify([...favorites]));
        }

        // Modal elements
        const modal = document.getElementById('checkout-modal');
        const modalBackdrop = modal.querySelector('[data-modal-backdrop]');
        const modalClose = modal.querySelector('[data-modal-close]');
        const modalCancel = modal.querySelector('[data-modal-cancel]');

        let currentItem = null;
        // Expose currentItem for optional server flows / stripe compatibility
        window.currentItem = null;

        function openModalForItem(item) {
            currentItem = item;
            window.currentItem = item; // expose globally (used by other integrations)
            document.getElementById('checkout-image').src = item.image || '';
            document.getElementById('checkout-image').alt = item.title || 'Item';
            document.getElementById('checkout-name').textContent = item.title || '';
            document.getElementById('checkout-desc').textContent = item.description || '';
            document.getElementById('checkout-duration').textContent = item.duration ? ('Duration: ' + item.duration) : '';
            document.getElementById('checkout-price').textContent = (item.currency ? item.currency + ' ' : '') + (item.price || '');
            checkoutIGN.value = '';
            showModal();
        }

        function showModal() {
            modal.setAttribute('aria-hidden', 'false');
            modal.classList.add('open');
            setTimeout(() => checkoutIGN.focus(), 50);
            document.addEventListener('focus', enforceFocus, true);
            document.addEventListener('keydown', handleKeydown);
        }

        function hideModal() {
            modal.setAttribute('aria-hidden', 'true');
            modal.classList.remove('open');
            currentItem = null;
            window.currentItem = null;
            document.removeEventListener('focus', enforceFocus, true);
            document.removeEventListener('keydown', handleKeydown);
        }

        function enforceFocus(e) {
            if (!modal.contains(e.target)) {
                e.stopPropagation();
                checkoutIGN.focus();
            }
        }

        function handleKeydown(e) {
            if (e.key === 'Escape') hideModal();
        }

        modalBackdrop.addEventListener('click', hideModal);
        modalClose.addEventListener('click', hideModal);
        modalCancel.addEventListener('click', (ev) => { ev.preventDefault(); hideModal(); });

        // Tebex redirect flow on confirm
        checkoutConfirm.addEventListener('click', (ev) => {
            ev.preventDefault();
            if (!currentItem && !window.currentItem) {
                alert('No item selected.');
                return;
            }
            const selectedItem = currentItem || window.currentItem;
            const ign = checkoutIGN.value && checkoutIGN.value.trim();
            if (!ign) {
                alert('Please enter your Minecraft IGN before confirming the purchase.');
                checkoutIGN.focus();
                return;
            }

            const provider = paymentProviderSelect.value || 'tebex';
            if (provider === 'tebex') {
                // find mapping
                const tebexPkg = ITEM_TO_TEBEX[selectedItem.id];
                if (!TEBEX_STORE_URL || TEBEX_STORE_URL === 'https://yourstore.tebex.io') {
                    // developer reminder to set store domain
                    const ok = confirm('TEBEX_STORE_URL is not configured in the page. Do you want to continue (you will be redirected to a placeholder)? Press Cancel to configure the store domain.');
                    if (!ok) return;
                }
                if (!tebexPkg) {
                    alert('This item is not mapped to a Tebex package yet. Please contact the server admin.');
                    return;
                }
                // Build Tebex package URL
                // Tebex package URLs are typically yourstore.tebex.io/package/<package-id-or-slug>
                // We'll add a 'player' query param as many Tebex stores accept this to prefill the player name.
                const base = TEBEX_STORE_URL.replace(/\/$/, '');
                const url = `${base}/package/${encodeURIComponent(tebexPkg)}?player=${encodeURIComponent(ign)}`;

                // redirect the user to Tebex hosted checkout
                window.location.href = url;
                return;
            }

            // other providers (Stripe path) are disabled in this build
            alert('Selected payment provider is not available.');
        });

        function renderItems(filterCategory = 'ranks') {
            storeGrid.innerHTML = '';
            const filtered = items.filter(it => it.category === filterCategory);
            storeGrid.setAttribute('data-item-count', filtered.length);
            if (filtered.length === 0) {
                storeGrid.innerHTML = '<p class="small-meta">No items found in this category.</p>';
                return;
            }

            filtered.forEach((it, index) => {
                const card = document.createElement('article');
                card.className = 'store-card';
                card.style.setProperty('--i', index); // used for staggered animation-delay
                card.setAttribute('data-id', it.id);
                card.innerHTML = `
                    <img src="${it.image}" alt="${escapeHtml(it.title)}">
                    <div class="card-body">
                        <div style="display:flex;align-items:center;gap:12px;">
                            <h3>${escapeHtml(it.title)} <span class="price-badge">${escapeHtml(it.currency)} ${escapeHtml(it.price)}</span></h3>
                        </div>
                        <p class="small-meta">${it.duration ? escapeHtml(it.duration) : ''}</p>
                        <p class="card-desc">${escapeHtml(it.description)}</p>
                        <div class="card-actions">
                            <button class="fav-btn" title="Favorite" aria-pressed="${favorites.has(it.id) ? 'true' : 'false'}">${favorites.has(it.id) ? '♥' : '♡'}</button>
                            <a class="buy-btn" href="#" data-item-id="${it.id}">Buy</a>
                        </div>
                    </div>
                `;
                // favorite toggle
                const favBtn = card.querySelector('.fav-btn');
                favBtn.addEventListener('click', () => {
                    if (favorites.has(it.id)) {
                        favorites.delete(it.id);
                        favBtn.textContent = '♡';
                        favBtn.setAttribute('aria-pressed', 'false');
                    } else {
                        favorites.add(it.id);
                        favBtn.textContent = '♥';
                        favBtn.setAttribute('aria-pressed', 'true');
                    }
                    saveFavs();
                });

                // Buy handler opens modal
                const buyBtn = card.querySelector('.buy-btn');
                buyBtn.addEventListener('click', (ev) => {
                    ev.preventDefault();
                    openModalForItem(it);
                });

                storeGrid.appendChild(card);
            });
        }

        // Escape helper
        function escapeHtml(str) {
            if (!str) return '';
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;');
        }

        // Category button events
        categoryButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                categoryButtons.forEach(b => { b.classList.remove('active'); b.setAttribute('aria-selected','false'); });
                btn.classList.add('active');
                btn.setAttribute('aria-selected','true');
                renderItems(btn.dataset.category);
            });
        });

        // initial render - use active or fallback
        const active = document.querySelector('.category-btn.active');
        const startCategory = active ? active.dataset.category : 'ranks';
        renderItems(startCategory);
    })();
    </script>
</body>
</html>